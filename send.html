<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨ë“œìŠ¤í… ì†¡ê¸ˆ(ìµœì í™”)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background-color: #f5f5f5; margin: 0; }
        h2 { margin-top: 0; color: #333; text-align: center;}
        
        .input-section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea { width: 100%; height: 120px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 12px; box-sizing: border-box; margin-bottom: 10px; }
        
        button.action-btn { width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        button.reset-btn { background-color: #6c757d; margin-top: 10px; }

        #qrContainer { display: none; text-align: center; margin-top: 20px; background: white; padding: 20px; border-radius: 12px; }
        #qrcode { display: inline-block; }
        .qr-desc { margin-top: 10px; font-size: 14px; color: #666; font-weight: bold; }

        #listContainer { display: flex; flex-direction: column; gap: 10px; }
        .card { background: white; padding: 15px; border-radius: 10px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .card:active { background-color: #f0f0f0; transform: scale(0.98); }
        .card.done { background-color: #d1e7dd; opacity: 0.6; text-decoration: line-through; border-color: #badbcc; }
        
        .info { display: flex; flex-direction: column; gap: 4px; }
        .amount { font-size: 18px; font-weight: bold; color: #d63384; }
        .bank-info { font-size: 16px; color: #333; font-weight: 500; }
        .name { font-size: 14px; color: #666; }

        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 20px; padding: 12px; position: fixed; z-index: 99; left: 50%; bottom: 30px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <h2>ğŸ’¸ ê³¨ë“œìŠ¤í… ì†¡ê¸ˆ</h2>

    <div id="inputSection" class="input-section">
        <textarea id="rawData" placeholder="DB ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        <button class="action-btn" onclick="generateQR()">PCì—ì„œ QRì½”ë“œ ìƒì„±í•˜ê¸°</button>
        <div id="qrContainer">
            <div id="qrcode"></div>
            <p class="qr-desc">íœ´ëŒ€í° ì¹´ë©”ë¼ë¡œ ìŠ¤ìº”í•˜ì„¸ìš”!</p>
        </div>
    </div>

    <div id="listContainer"></div>
    <div id="resetSection" style="display:none; text-align: center; margin-top: 20px;">
        <button class="action-btn reset-btn" onclick="resetAll()">ìƒˆë¡œ ì…ë ¥í•˜ê¸°</button>
    </div>
    <div id="toast">ë³µì‚¬ ì™„ë£Œ!</div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° í™•ì¸
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const compressedData = urlParams.get('d');
            if (compressedData) {
                try {
                    const decompressed = LZString.decompressFromEncodedURIComponent(compressedData);
                    if (decompressed) renderList(decompressed);
                } catch (e) { alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); }
            }
        };

        // 1. PC: QRì½”ë“œ ìƒì„± (ìµœì í™” ì ìš©: í•„ìš”í•œ ë°ì´í„°ë§Œ ë½‘ì•„ì„œ ì••ì¶•)
        function generateQR() {
            const raw = document.getElementById('rawData').value.trim();
            if (!raw) { alert("ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            const rows = raw.split('\n');
            let optimizedData = [];

            // â˜… í•µì‹¬: ì“¸ë°ì—†ëŠ” ë°ì´í„° ë‹¤ ë²„ë¦¬ê³  í•„ìš”í•œ ê²ƒë§Œ ì¶”ë¦¼
            rows.forEach(row => {
                const cols = row.split(/\t/);
                if (cols.length < 7) return; 
                // ìˆœì„œ: ê¸ˆì•¡(2), ì€í–‰(4), ê³„ì¢Œ(5), ì˜ˆê¸ˆì£¼(6)
                // êµ¬ë¶„ì ';;' ì‚¬ìš©
                optimizedData.push(`${cols[2]};;${cols[4]};;${cols[5]};;${cols[6]}`);
            });

            // ì¤„ë°”ê¿ˆì€ '||'ë¡œ êµ¬ë¶„
            const finalString = optimizedData.join('||');

            // ì••ì¶•
            const compressed = LZString.compressToEncodedURIComponent(finalString);
            const currentUrl = window.location.href.split('?')[0];
            const targetUrl = `${currentUrl}?d=${compressed}`;

            if (targetUrl.length > 4000) { // í•œë„ë¥¼ 4000ìë¡œ ëŠ˜ë¦¼ (ì´ì œ ë°ì´í„°ê°€ ì‘ì•„ì„œ ì¶©ë¶„í•¨)
                alert("ë°ì´í„°ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. 50ì¤„ ì´í•˜ë¡œ ë‚˜ëˆ ì£¼ì„¸ìš”.");
                return;
            }

            const qrContainer = document.getElementById('qrContainer');
            const qrcodeDiv = document.getElementById('qrcode');
            qrContainer.style.display = 'block';
            qrcodeDiv.innerHTML = ''; 

            new QRCode(qrcodeDiv, {
                text: targetUrl,
                width: 250, // QR í¬ê¸° ì¢€ í‚¤ì›€
                height: 250,
                correctLevel : QRCode.CorrectLevel.L
            });
        }

        // 2. ëª¨ë°”ì¼: ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderList(rawData) {
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('resetSection').style.display = 'block';

            // '||'ë¡œ ì¤„ë°”ê¿ˆ ë¶„ë¦¬
            const rows = rawData.split('||');
            const container = document.getElementById('listContainer');
            container.innerHTML = '';

            rows.forEach(row => {
                // ';;'ë¡œ ë°ì´í„° ë¶„ë¦¬
                const cols = row.split(';;');
                if (cols.length < 4) return;

                const amount = cols[0];
                const bankName = cols[1];
                const accountNum = cols[2];
                const holderName = cols[3];

                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = function() { copyToClipboard(accountNum, card); };

                const fmtAmount = Number(amount).toLocaleString() + 'ì›';
                card.innerHTML = `
                    <div class="info">
                        <span class="amount">${fmtAmount}</span>
                        <span class="bank-info">${bankName} ${accountNum}</span>
                        <span class="name">${holderName}</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // 3. ë³µì‚¬ ê¸°ëŠ¥
        function copyToClipboard(text, element) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            element.classList.add('done');
            showToast(`${text} ë³µì‚¬ë¨`);
        }

        function showToast(msg) {
            const x = document.getElementById("toast");
            x.innerText = msg;
            x.className = "show";
            setTimeout(() => { x.className = x.className.replace("show", ""); }, 2000);
        }

        function resetAll() { window.location.href = window.location.href.split('?')[0]; }
    </script>
</body>
</html>
