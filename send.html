<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨ë“œìŠ¤í… ì†¡ê¸ˆ(ì‹¤íŒ¨ê´€ë¦¬)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background-color: #f5f5f5; margin: 0; }
        h2 { margin-top: 0; color: #333; text-align: center;}
        
        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        .input-section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea { width: 100%; height: 120px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 12px; box-sizing: border-box; margin-bottom: 10px; }
        
        button.action-btn { width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        button.reset-btn { background-color: #6c757d; margin-top: 10px; }

        /* QR ì½”ë“œ */
        #qrContainer { display: none; text-align: center; margin-top: 20px; background: white; padding: 20px; border-radius: 12px; }
        #qrcode { display: inline-block; }
        .qr-desc { margin-top: 10px; font-size: 14px; color: #666; font-weight: bold; }

        /* ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
        #listContainer, #failContainer { display: flex; flex-direction: column; gap: 10px; }
        h3 { margin: 20px 0 10px 0; font-size: 16px; color: #555; border-bottom: 2px solid #ddd; padding-bottom: 5px; }
        
        /* ì¹´ë“œ ë””ìì¸ */
        .card { 
            background: white; 
            border-radius: 10px; 
            border: 1px solid #eee; 
            display: flex; 
            overflow: hidden; /* ë²„íŠ¼ ì‚ì ¸ë‚˜ì˜´ ë°©ì§€ */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* ì¹´ë“œ ë‚´ìš© (ì™¼ìª½) */
        .card-content {
            padding: 15px;
            flex-grow: 1;
            cursor: pointer;
        }
        .card-content:active { background-color: #f8f9fa; }

        /* ë²„íŠ¼ ì˜ì—­ (ì˜¤ë¥¸ìª½) */
        .card-actions {
            display: flex;
            flex-direction: column;
            width: 60px;
        }
        .btn-ok {
            flex: 1;
            background-color: #e8f5e9;
            color: #2e7d32;
            border: none;
            border-left: 1px solid #eee;
            font-size: 20px;
            cursor: pointer;
        }
        .btn-fail {
            flex: 1;
            background-color: #ffebee;
            color: #c62828;
            border: none;
            border-top: 1px solid #eee;
            border-left: 1px solid #eee;
            font-size: 20px;
            cursor: pointer;
        }

        /* ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
        .card.done { background-color: #d1e7dd; opacity: 0.6; }
        .card.done .card-content { text-decoration: line-through; }
        .card.done .card-actions { display: none; } /* ì™„ë£Œë˜ë©´ ë²„íŠ¼ ìˆ¨ê¹€ */

        .card.fail { background-color: #ffcdd2; opacity: 1; border-color: #e57373; }
        .card.fail .amount { color: #b71c1c; }
        .card.fail .btn-fail { display: none; } /* ì‹¤íŒ¨ ëª©ë¡ì—ì„  ì‹¤íŒ¨ ë²„íŠ¼ ìˆ¨ê¹€ */
        .card.fail .btn-ok { height: 100%; border-top: none; background-color: white; color: #333; font-size: 14px; } /* ë³µêµ¬ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ */

        .info { display: flex; flex-direction: column; gap: 4px; }
        .amount { font-size: 18px; font-weight: bold; color: #d63384; }
        .bank-info { font-size: 16px; color: #333; font-weight: 500; }
        .name { font-size: 14px; color: #666; }

        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 20px; padding: 12px; position: fixed; z-index: 99; left: 50%; bottom: 30px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        
        /* ìˆ¨ê¹€ í´ë˜ìŠ¤ */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <h2>ğŸ’¸ ê³¨ë“œìŠ¤í… ì •ì‚°</h2>

    <div id="inputSection" class="input-section">
        <textarea id="rawData" placeholder="DB ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        <button class="action-btn" onclick="generateQR()">PCì—ì„œ QRì½”ë“œ ìƒì„±í•˜ê¸°</button>
        <div id="qrContainer">
            <div id="qrcode"></div>
            <p class="qr-desc">íœ´ëŒ€í° ì¹´ë©”ë¼ë¡œ ìŠ¤ìº”í•˜ì„¸ìš”!</p>
        </div>
    </div>

    <div id="pendingSection" class="hidden">
        <h3>ğŸ“¤ ì†¡ê¸ˆ ëŒ€ê¸° ëª©ë¡ <span id="pendingCount"></span></h3>
        <div id="listContainer"></div>
    </div>

    <div id="failSection" class="hidden">
        <h3 style="color:#c62828;">âŒ ì†¡ê¸ˆ ì‹¤íŒ¨/ë³´ë¥˜ <span id="failCount"></span></h3>
        <div id="failContainer"></div>
    </div>

    <div id="doneSection" class="hidden">
        <h3 style="color:#2e7d32;">âœ… ì†¡ê¸ˆ ì™„ë£Œ</h3>
        <div id="doneContainer" style="display:flex; flex-direction:column; gap:10px;"></div>
    </div>

    <div id="resetSection" style="display:none; text-align: center; margin-top: 40px; margin-bottom: 20px;">
        <button class="action-btn reset-btn" onclick="resetAll()">ìƒˆë¡œ ì…ë ¥í•˜ê¸°</button>
    </div>

    <div id="toast">ë³µì‚¬ ì™„ë£Œ!</div>

    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const compressedData = urlParams.get('d');
            if (compressedData) {
                try {
                    const decompressed = LZString.decompressFromEncodedURIComponent(compressedData);
                    if (decompressed) renderList(decompressed);
                } catch (e) { alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); }
            }
        };

        function generateQR() {
            const raw = document.getElementById('rawData').value.trim();
            if (!raw) { alert("ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            const rows = raw.split('\n');
            let optimizedData = [];
            rows.forEach(row => {
                const cols = row.split(/\t/);
                if (cols.length < 7) return; 
                optimizedData.push(`${cols[2]};;${cols[4]};;${cols[5]};;${cols[6]}`);
            });

            const finalString = optimizedData.join('||');
            const compressed = LZString.compressToEncodedURIComponent(finalString);
            const currentUrl = window.location.href.split('?')[0];
            const targetUrl = `${currentUrl}?d=${compressed}`;

            if (targetUrl.length > 4000) { alert("ë°ì´í„°ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. 50ì¤„ ì´í•˜ë¡œ ë‚˜ëˆ ì£¼ì„¸ìš”."); return; }

            document.getElementById('qrContainer').style.display = 'block';
            document.getElementById('qrcode').innerHTML = ''; 
            new QRCode(document.getElementById('qrcode'), { text: targetUrl, width: 250, height: 250, correctLevel : QRCode.CorrectLevel.L });
        }

        function renderList(rawData) {
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('resetSection').style.display = 'block';
            document.getElementById('pendingSection').classList.remove('hidden');

            const rows = rawData.split('||');
            const container = document.getElementById('listContainer');
            container.innerHTML = '';

            rows.forEach(row => {
                const cols = row.split(';;');
                if (cols.length < 4) return;
                createCard(cols[0], cols[1], cols[2], cols[3], container);
            });
            updateCounts();
        }

        function createCard(amount, bankName, accountNum, holderName, parentElement) {
            const fmtAmount = Number(amount).toLocaleString() + 'ì›';
            const copyText = `${fmtAmount} ${bankName} ${accountNum} ${holderName}`;

            const card = document.createElement('div');
            card.className = 'card';
            
            // ì¹´ë“œ ë‚´ìš© (ì™¼ìª½) - í´ë¦­ ì‹œ ë³µì‚¬
            const contentDiv = document.createElement('div');
            contentDiv.className = 'card-content';
            contentDiv.onclick = function() { copyToClipboard(copyText); };
            contentDiv.innerHTML = `
                <div class="info">
                    <span class="amount">${fmtAmount}</span>
                    <span class="bank-info">${bankName} ${accountNum}</span>
                    <span class="name">${holderName}</span>
                </div>
            `;

            // ë²„íŠ¼ ì˜ì—­ (ì˜¤ë¥¸ìª½)
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'card-actions';

            // ì„±ê³µ ë²„íŠ¼ (V)
            const btnOk = document.createElement('button');
            btnOk.className = 'btn-ok';
            btnOk.innerHTML = 'âœ”';
            btnOk.onclick = function() { moveToDone(card); };

            // ì‹¤íŒ¨ ë²„íŠ¼ (X)
            const btnFail = document.createElement('button');
            btnFail.className = 'btn-fail';
            btnFail.innerHTML = 'âœ–';
            btnFail.onclick = function() { moveToFail(card, amount, bankName, accountNum, holderName); };

            actionsDiv.appendChild(btnOk);
            actionsDiv.appendChild(btnFail);

            card.appendChild(contentDiv);
            card.appendChild(actionsDiv);
            parentElement.appendChild(card);
        }

        // ì„±ê³µ ì²˜ë¦¬ (ì™„ë£Œ ëª©ë¡ìœ¼ë¡œ ì´ë™)
        function moveToDone(card) {
            card.classList.add('done');
            document.getElementById('doneSection').classList.remove('hidden');
            document.getElementById('doneContainer').prepend(card); // ë§¨ ìœ„ë¡œ
            updateCounts();
        }

        // ì‹¤íŒ¨ ì²˜ë¦¬ (ì‹¤íŒ¨ ëª©ë¡ìœ¼ë¡œ ì´ë™)
        function moveToFail(card, amount, bankName, accountNum, holderName) {
            // ê¸°ì¡´ ì¹´ë“œëŠ” ì œê±°í•˜ê³  ì‹¤íŒ¨ ì¹´ë“œë¡œ ì¬ìƒì„±
            card.remove();
            
            document.getElementById('failSection').classList.remove('hidden');
            const failContainer = document.getElementById('failContainer');
            
            const failCard = document.createElement('div');
            failCard.className = 'card fail';
            
            const fmtAmount = Number(amount).toLocaleString() + 'ì›';
            const copyText = `${fmtAmount} ${bankName} ${accountNum} ${holderName}`;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'card-content';
            contentDiv.onclick = function() { copyToClipboard(copyText); }; // ì‹¤íŒ¨í•œ ê²ƒë„ ë‹¤ì‹œ ë³µì‚¬ëŠ” ê°€ëŠ¥í•˜ê²Œ
            contentDiv.innerHTML = `
                <div class="info">
                    <span class="amount">${fmtAmount}</span>
                    <span class="bank-info">${bankName} ${accountNum}</span>
                    <span class="name">${holderName} (í™•ì¸ í•„ìš”)</span>
                </div>
            `;

            // ë³µêµ¬ ë²„íŠ¼ (ë‹¤ì‹œ ëŒ€ê¸° ëª©ë¡ìœ¼ë¡œ)
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'card-actions';
            const btnRestore = document.createElement('button');
            btnRestore.className = 'btn-ok';
            btnRestore.innerText = 'ë³µêµ¬';
            btnRestore.onclick = function() { 
                failCard.remove();
                createCard(amount, bankName, accountNum, holderName, document.getElementById('listContainer'));
                updateCounts();
            };
            actionsDiv.appendChild(btnRestore);

            failCard.appendChild(contentDiv);
            failCard.appendChild(actionsDiv);
            failContainer.appendChild(failCard);
            
            updateCounts();
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showToast("ë³µì‚¬ ì™„ë£Œ!");
        }

        function showToast(msg) {
            const x = document.getElementById("toast");
            x.innerText = msg;
            x.className = "show";
            setTimeout(() => { x.className = x.className.replace("show", ""); }, 1000);
        }

        function updateCounts() {
            const pending = document.getElementById('listContainer').children.length;
            const failed = document.getElementById('failContainer').children.length;
            
            document.getElementById('pendingCount').innerText = `(${pending}ê±´)`;
            document.getElementById('failCount').innerText = `(${failed}ê±´)`;

            if(pending === 0 && failed === 0) {
               // ë‹¤ ì²˜ë¦¬ë¨
            }
        }

        function resetAll() { window.location.href = window.location.href.split('?')[0]; }
    </script>
</body>
</html>
